(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,o=window.React;var a=e.n(o);const i=window.wp.i18n,n=window.wp.blockEditor,l=window.wp.components,s=window.wp.element;function r(e){var{isUserAuthorized:t,locations:a,categories:n,services:s,providers:r,attributes:p,setAttributes:c,closeModal:d,saveParameters:m}=e;return(0,o.createElement)(l.Modal,{className:"sb-widget-modal",title:(0,i.__)("Edit predefined parameters","simplybook"),onRequestClose:d},(0,o.createElement)(l.PanelBody,null,t?(0,o.createElement)(o.Fragment,null,(0,o.createElement)("div",{className:"wp-sb-popup-info"},(0,o.createElement)("p",{className:"wp-sb--p"},(0,i.__)("This feature allows you to customize your booking widget specifically for a service, provider, category, or location.","simplybook")),(0,o.createElement)("p",{className:"wp-sb--p"},(0,i.__)("For example, if you have two services, A and B, and choose service A as predefined, the widget will open directly on that service, skipping the step of choosing a service. This is useful if you want to display only certain services on a specific page of your website. Note that if you select a provider not connected to the chosen service, the widget will not work. These settings will immediately apply to the widget, ensuring a streamlined booking process.","simplybook"))),(0,o.createElement)("div",{className:"wp-sb-popup-predefine-form"},a.length>0&&(0,o.createElement)(l.SelectControl,{label:(0,i.__)("Predefined location","simplybook"),value:p.location,options:[{label:(0,i.__)("Select location","simplybook"),value:0},...a.map((e=>({label:e.name,value:e.id})))],onChange:e=>c({location:parseInt(e)})}),n.length>0&&(0,o.createElement)(l.SelectControl,{label:(0,i.__)("Predefined category","simplybook"),value:p.category,options:[{label:(0,i.__)("Select category","simplybook"),value:0},...n.map((e=>({label:e.name,value:e.id})))],onChange:e=>c({category:parseInt(e)})}),s.length>0&&(0,o.createElement)(l.SelectControl,{label:(0,i.__)("Predefined service","simplybook"),value:p.service,options:[{label:(0,i.__)("Select service","simplybook"),value:0},...s.map((e=>({label:e.name,value:e.id})))],onChange:e=>c({service:parseInt(e)})}),r.length>0&&(0,o.createElement)(l.SelectControl,{label:(0,i.__)("Predefined provider","simplybook"),value:p.provider,options:[{label:(0,i.__)("Select provider","simplybook"),value:0},...r.map((e=>({label:e.name,value:e.id})))],onChange:e=>{c("any"!==e?{provider:parseInt(e)}:{provider:"any"})}})),(0,o.createElement)("div",{className:"wp-sb-popup-predefine-btnBar"},(0,o.createElement)(l.Button,{onClick:m,className:"sb-widget-save-btn",isPrimary:!0},(0,i.__)("Save","simplybook")))):(0,o.createElement)("p",{className:"sb-widget-alert"},(0,i.__)("You are not authorized in ","simplybook"),(0,o.createElement)("a",{href:"/wp-admin/admin.php?page=simplybook-integration"},(0,i.__)("SimplyBook.me plugin","simplybook")))))}const p=JSON.parse('{"u2":"simplybook/widget","Y4":{"location":{"type":"number","default":0},"category":{"type":"number","default":0},"service":{"type":"number","default":0},"provider":{"type":"string","default":0}}}');(0,t.registerBlockType)(p.u2,{edit:function(e){const{attributes:t,setAttributes:p}=e,c=(0,n.useBlockProps)(),[d,m]=(0,s.useState)(!1),[b,u]=(0,s.useState)(!1),[w,v]=(0,s.useState)(!1),[y,g]=(0,s.useState)([]),[f,_]=(0,s.useState)([]),[h,k]=(0,s.useState)([]),[E,S]=(0,s.useState)([]),[N,P]=(0,s.useState)(""),C=a().createRef();(0,s.useEffect)((()=>{const e=async e=>{const t=await fetch("/wp-json/simplybook/v1/internal/"+e);return await t.json()};e("is-authorized").then(v),w&&Promise.all([e("locations"),e("categories"),e("services"),e("providers")]).then((([e,t,o,a])=>{g(e),_(t),k(o),S(a)}))}),[w]);const B=()=>m(!1);return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(n.BlockControls,null,(0,o.createElement)(l.ToolbarGroup,null,(0,o.createElement)(l.ToolbarButton,{onClick:()=>(()=>{console.log("preview");let e=new FormData;e.append("action","sb_preview_widget"),t.location&&e.append("formData[predefined][location]",t.location),t.category&&e.append("formData[predefined][category]",t.category),t.service&&e.append("formData[predefined][service]",t.service),t.provider&&e.append("formData[predefined][provider]",t.provider),e.append("_wpnonce",window.simplybookData?.nonce),e=new URLSearchParams(e).toString();let o=new XMLHttpRequest;o.open("POST","/wp-admin/admin-ajax.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var e=JSON.parse(o.responseText);e&&e.html&&(P(e.html),u(!0),setTimeout((()=>{var e=document.getElementById("simplybook-preview-modal").getElementsByTagName("script");if(0!==e.length){var t=e[0].innerHTML.replace("DOMContentLoaded","sbDOMContentLoaded");window.eval(t);var o=new Event("sbDOMContentLoaded");document.dispatchEvent(o)}else console.warn("No script found in widget preview")}),300))}},o.send(e)})(),icon:"visibility"},(0,i.__)("Preview","simplybook")))),(0,o.createElement)("div",{...c},(0,o.createElement)(l.PanelBody,null,(0,o.createElement)("div",{className:"sb-widget-container"},(0,o.createElement)(l.Dashicon,{icon:"simplybook",size:25,className:"sb-widget-icon"}),(0,o.createElement)("h3",{className:"wp-sb-title wp-sb-title_h3 sb-widget-title"},(0,i.__)("SimplyBook.me Widget","simplybook")),(0,o.createElement)("p",{className:"wp-sb-txt wp-sb--p wp-sb--p_secondary --subtitle"},(0,i.__)("Easily customize and streamline your booking process with predefined options for services, providers, categories and locations.","simplybook")),w?(0,o.createElement)(o.Fragment,null,y.length>0&&t.location?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-location"},(0,i.__)("Location: ","simplybook")+y.find((e=>e.id===t.location)).name):null,f.length>0&&t.category?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-category"},(0,i.__)("Category: ","simplybook")+f.find((e=>e.id===t.category)).name):null,h.length>0&&t.service?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-service"},(0,i.__)("Service: ","simplybook")+h.find((e=>e.id===t.service)).name):null,E.length>0&&t.provider?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-provider"},(0,i.__)("Provider: ","simplybook")+E.find((e=>e.id===t.provider)).name):null,(0,o.createElement)(l.Button,{onClick:()=>m(!0),className:"sb-widget-edit-btn",isPrimary:!0},(0,i.__)("Edit predefined parameters","simplybook")),(0,o.createElement)("div",{style:{clear:"both"}})):(0,o.createElement)("p",{className:"sb-widget-alert"},(0,i.__)("You are not authorized in ","simplybook"),(0,o.createElement)("a",{href:"/wp-admin/admin.php?page=simplybook-integration"},(0,i.__)("SimplyBook.me plugin","simplybook"))))),d&&(0,o.createElement)(r,{isUserAuthorized:w,locations:y,categories:f,services:h,providers:E,attributes:t,setAttributes:p,saveParameters:()=>{p(t),B()},closeModal:B}),b&&(0,o.createElement)(l.Modal,{className:"sb-widget-modal sb-widget-preview-modal",title:(0,i.__)("WidgetPreview","simplybook"),onRequestClose:()=>u(!1),ref:C},(0,o.createElement)(l.PanelBody,null,(0,o.createElement)("div",{dangerouslySetInnerHTML:{__html:N},id:"simplybook-preview-modal"})))))},save:function(){return(0,o.createElement)("div",{...n.useBlockProps.save()},(0,o.createElement)(n.InnerBlocks.Content,null))},attributes:p.Y4})})();