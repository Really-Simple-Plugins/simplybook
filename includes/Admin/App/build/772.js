"use strict";(self.webpackChunksimplybook_app=self.webpackChunksimplybook_app||[]).push([[772],{1674:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(4848),a=(0,n(1609).memo)((function(e){var t=e.className,n=e.children,a="bg-white shadow-md rounded-xl  ".concat(t);return(0,r.jsx)("div",{className:a,children:n})}));a.displayName="Block";const o=a},9587:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(4848),a=n(640),o=n(1609),s=n(7723),i=(0,o.memo)((function(e){var t=e.label,n=e.context,o=e.help,i=e.error,l=e.reverseLabel,d=void 0!==l&&l,c=e.className,m=void 0===c?"":c,u=e.inputId,p=e.required,g=void 0!==p&&p,y=e.children,f=["flex w-full flex-col",m,"pt-4"].filter(Boolean).join(" "),b=["flex w-full flex-col",d?"flex-col-reverse":""].filter(Boolean).join(" ");return(0,r.jsxs)("div",{className:f,children:[(0,r.jsxs)("div",{className:b,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(a.b,{className:"cursor-pointer pb-1 font-medium text-black text-md",htmlFor:u,children:[t,g&&(0,r.jsxs)("span",{className:"ml-1 text-gray-500 font-normal text-xs",children:["(",(0,s.__)("Required","simplybook"),")"]})]}),o&&(0,r.jsx)("p",{className:"pb-1 text-xs font-light text-gray-600",children:o})]}),y]}),i&&(0,r.jsx)("p",{className:"mt-2 text-xs font-light text-red-600",role:"alert",children:i}),n&&(0,r.jsx)("p",{className:"mt-2 text-xs font-light text-gray-600",children:n})]})}));i.displayName="FieldWrapper";const l=i},8908:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(4848),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a.apply(this,arguments)},o=function(e){var t=e.children,n=e.onClick,o=e.btnVariant,s=void 0===o?"secondary":o,i=e.disabled,l=void 0!==i&&i,d=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["children","onClick","btnVariant","disabled"]),c="".concat("font-semibold py-2 px-6 rounded-full transition-all duration-200"," ").concat({primary:"bg-secondary text-white hover:bg-secondary-dark",secondary:"bg-tertiary text-white hover:bg-tertiary-dark",tertiary:"border-2 border-tertiary bg-transparent text-black hover:bg-tertiary-light"}[s]," ").concat(l?"opacity-50 cursor-not-allowed":"");return(0,r.jsx)("button",a({onClick:n,className:c,disabled:l},d,{children:t}))};o.displayName="ButtonInput";const s=o},5071:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(1609);const a=({children:e,className:t="p-5 pt-0"})=>(0,r.createElement)("div",{className:t},e);a.displayName="BlockContent";const o=a},7330:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(1609);const a=({title:e,controls:t})=>(0,r.createElement)("div",{className:"flex items-center justify-between px-5 py-4"},(0,r.createElement)("h2",{className:"text-base font-bold"},e),t);a.displayName="BlockHeading";const o=a},5782:(e,t,n)=>{n.d(t,{A:()=>f});var r=n(1609),a=n(9785),o=n(4848),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)},i=(0,r.forwardRef)((function(e,t){var n=e.type,r=void 0===n?"text":n,a=e.className,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["type","className"]);return(0,o.jsx)("input",s({ref:t,type:r,className:"w-full rounded-md border border-gray-300 p-2 focus:border-blue-500 focus:outline-none focus:ring disabled:cursor-not-allowed disabled:border-gray-200 disabled:bg-gray-200 ".concat(a||"")},i))}));i.displayName="TextInput";const l=i;var d=n(9587);const c=(0,r.forwardRef)((({field:e,fieldState:t,label:n,help:a,context:o,className:s,...i},c)=>{const m=i.id||e.name;return(0,r.createElement)(d.A,{label:n,help:a,error:t?.error?.message,context:o,className:s,inputId:m,required:i.required},(0,r.createElement)(l,{...e,id:m,type:"text","aria-invalid":!!t?.error?.message,...i}))}));c.displayName="TextField";const m=c;var u=n(6244),p=n(7723);const g={text:m,api:m},y=(0,r.memo)((({setting:e,control:t,...n})=>{if(!1===e.visible)return(0,r.createElement)("input",{type:"hidden",defaultValue:e.value||e.default});const o=g[e.type];if(!o)return(0,r.createElement)("div",{className:"w-full"},"Unknown field type: ",e.type," ",e.id);const s={...e.required&&{required:{value:!0,message:e.requiredMessage||(0,p.__)("This field is required","simplybook")}},...e.validation?.regex&&{pattern:{value:new RegExp(e.validation.regex),message:e.validation.message||(0,p.__)("Invalid format","simplybook")}},...e.min&&{min:e.min},...e.max&&{max:e.max},...e.minLength&&{minLength:e.minLength},...e.maxLength&&{maxLength:e.maxLength},...e.validate&&{validate:e.validate}};return(0,r.createElement)(u.A,null,(0,r.createElement)(a.xI,{name:e.id,control:t,rules:s,defaultValue:e.value||e.default,render:({field:t,fieldState:a})=>(0,r.createElement)(o,{field:t,fieldState:a,required:e.required,label:e.label||e.id,disabled:n.settingsIsUpdating||e.disabled,context:e.context,help:e.help,options:e.options,...n})}))}));y.displayName="FormField";const f=y},6905:(e,t,n)=>{n.d(t,{A:()=>o}),n(1609);var r=n(9270),a=n(8220);const o=()=>{const{settingsId:e}=a.Route.useParams(),t=(0,r.I)({queryKey:["settings_menu"],queryFn:()=>new Promise(((e,t)=>{window.simplybook&&window.simplybook.settings_menu&&e(window.simplybook.settings_menu),t(new Error("Settings menu not found"))})),initialData:window.simplybook&&window.simplybook.settings_menu,staleTime:3e5}),n=t.data.find((t=>t.id===e))||{};return{menu:t.data,currentForm:n,menuIsLoading:t.isLoading,menuIsError:t.isError}}},8220:(e,t,n)=>{n.r(t),n.d(t,{Route:()=>A});var r=n(1609),a=n(6037),o=n(7665),s=n(9270),i=n(7097),l=n(1455),d=n.n(l);const c=simplybook.nonce,m=u("site_url");function u(e){let t=simplybook[e];return"https:"!==window.location.protocol||t.includes("https://")||(t=t.replace("http://","https://")),t}u("ajax_url");const p=async(e,t="POST",n={})=>{const r={path:e,method:t,data:n};r.path="simplybook/v1/"+r.path+(m.includes("?")?"&":"?")+"&token="+Math.random().toString(36).substring(2,7),r.data={...n,nonce:c},console.log("request : ",r);try{return await(async(e,t="POST",n={})=>{const r={path:e,method:t,data:n};return console.log("simplybook/v1/settings/get_fields"),console.log("Fetch: Requesting data from "+e+" using "+t+" method"),await d()(r)})(r.path,r.method,r.data)}catch(e){((e,t)=>{console.error(`API Error at ${t}:`,e.message||e)})(e,r.path)}},g=()=>{const e=(0,o.jE)(),t=(0,s.I)({queryKey:["settings_fields"],queryFn:()=>(async({withValues:e=!0})=>(await p("settings/get_fields","POST",{withValues:e})).data)({withValues:!0}),staleTime:3e5,initialData:window.simplybook&&window.simplybook.settings_fields,retry:0,select:e=>[...e]}),{mutateAsync:n,isLoading:r}=(0,i.n)({mutationFn:async e=>(await new Promise((e=>setTimeout(e,1e3))),e),onSuccess:()=>{e.invalidateQueries(["settings_fields"])}});return{settings:t.data,saveSettings:n,isSavingSettings:r,invalidateSettings:()=>e.invalidateQueries(["settings_fields"])}};var y=n(9785),f=n(6905),b=n(5782);const h=()=>{const[e,t]=(0,r.useState)(0);return(0,r.useEffect)((()=>{const e=()=>{const e=document.documentElement.scrollHeight-window.innerHeight;t(Math.round(window.scrollY/e*100))};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]),document.documentElement.scrollHeight>window.innerHeight?(0,r.createElement)("div",{className:"h-1 w-full bg-gray-200"},(0,r.createElement)("div",{className:"h-full bg-blue-500",style:{width:`${Math.max(e,10)}%`}})):null};h.displayName="FormScrollProgressLine";const v=h;var w=n(8908),x=n(7723);function k({onSubmit:e,control:t}){const{isDirty:n,isSubmitting:a,isValidating:o,isValid:s,dirtyFields:i}=(0,y.lN)({control:t});return(0,r.createElement)("div",{className:"sticky z-10 rounded-b-md bg-gray-50 shadow-md"},(0,r.createElement)(v,null),(0,r.createElement)("div",{className:"flex flex-row justify-end p-5"},n&&(0,r.createElement)("p",null,(0,x.__)("You have unsaved changes","simplybook")),a&&(0,r.createElement)("p",null,(0,x.__)("Saving...","simplybook")),(0,r.createElement)(w.A,{onClick:e,disabled:a},(0,x.__)("Save","simplybook"))),"dirtyFields: ",JSON.stringify(i))}k.displayName="FormFooter";const N=k;var E=n(1674),j=n(7330),S=n(5071);const _=(0,r.memo)((({group:e,currentGroupFields:t,control:n,isLastGroup:a})=>{const o=a?"rounded-b-none":"mb-5";return(0,r.createElement)(E.A,{key:e.id,className:o},(0,r.createElement)(j.A,{title:e.title}),(0,r.createElement)(S.A,null,(0,r.createElement)("div",{className:"flex flex-wrap"},t.map((e=>(0,r.createElement)(b.A,{setting:e,key:e.id,control:n}))))))}));_.displayName="SettingsGroupBlock";const O=_;var F=n(5959);const A=(0,a.uV)("/settings/$settingsId")({loader:({params:e})=>(e=>{const t=(window.simplybook?.settings_menu||[]).find((t=>t.id===e));if(!t)throw new Error("Settings not found");return{settingsData:t}})(e.settingsId),component:function(){const{settingsId:e}=A.useParams(),{settings:t,saveSettings:n}=g(),{currentForm:a}=(0,f.A)(),o=(0,r.useMemo)((()=>t.filter((t=>t.menu_id===e))),[t,e]),s=(0,r.useMemo)((()=>I(t,e)),[t,e]),i=(0,r.useMemo)((()=>I(t,e,"value")),[t,e]),l=(0,r.useMemo)((()=>a.groups[a.groups.length-1]),[a.groups]),{handleSubmit:d,control:c,reset:m,formState:{isDirty:u}}=(0,y.mN)({defaultValues:s,values:i});return(0,F.K)({blockerFn:()=>window.confirm("Are you sure you want to leave?"),condition:u}),(0,r.createElement)("form",null,a.groups?.map((e=>{const t=l.id===e.id,n=o.filter((t=>t.group_id===e.id));return(0,r.createElement)(O,{key:e.id,group:e,currentGroupFields:n,control:c,isLastGroup:t})})),(0,r.createElement)(N,{onSubmit:d((e=>{n(e).then((()=>{m(s)}))})),control:c}))}}),I=(e,t,n="default")=>{const r={};return e.forEach((e=>{e.menu_id===t&&(r[e.id]=e[n])})),r}}}]);